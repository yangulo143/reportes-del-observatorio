"0","# --- 1. LIBRERIAS ---"
"0","library(tidyverse)"
"0","library(janitor)      # Para limpiar nombres de columnas"
"0","library(lubridate)    # Para fechas"
"0","library(plotly)       # Graficos interactivos"
"0","library(DT)           # Tablas"
"0","library(wordcloud2)   # Nube de palabras"
"0","library(widyr)        # Para correlaciones y redes (pairwise)"
"0","library(tidygraph)    # Para manipular redes"
"0","library(ggraph)       # Para visualizar redes"
"0","library(countrycode)  # Para normalizar paises"
"0",""
"0",""
"0",""
"0","# --- 2. CARGA DE DATOS ---"
"0","# IMPORTANTE: Reemplaza ""scopus.csv"" con tu archivo real."
"0",""
"0","scopus_raw <- read_csv(""scopus3.csv"") "
"0",""
"0",""
"0",""
"0","# --- SIMULACION DE DATOS SCOPUS (Para que el codigo funcione al copiarlo) ---"
"0","# Creo un dataframe falso con la estructura típica de Scopus"
"0","scopus_raw2 <- tibble("
"0","  `Source title` = sample(c(""Journal of Science"", ""Health Data"", ""Tech Review""), 100, replace = T),"
"0","  `Year` = sample(2018:2024, 100, replace = T),"
"0","  `Document Type` = sample(c(""Article"", ""Review"", ""Conference Paper""), 100, replace = T),"
"0","  `Authors` = sample(c(""Smith, J.; Doe, A."", ""Garcia, M."", ""Lee, K.; Smith, J.; Chen, Y.""), 100, replace = T),"
"0","  `Author Keywords` = sample(c(""AI; big data"", ""health; medicine"", ""AI; machine learning; python""), 100, replace = T),"
"0","  `Affiliations` = sample(c(""Univ A, USA; Univ B, UK"", ""Univ C, Peru"", ""Univ D, Spain""), 100, replace = T),"
"0","  `Funding Details` = sample(c(""Grant A"", NA, ""NIH""), 100, replace = T),"
"0","  `Language of Original Document` = sample(c(""English"", ""Spanish"", ""English""), 100, replace = T)"
"0",")"
"0",""
"0",""
"0",""
"0",""
"0",""
"0","# --- 3. LIMPIEZA Y PROCESAMIENTO (LA MAGIA ""TIDY"") ---"
"0",""
"0","# A. Limpieza de nombres de columnas"
"0","data <- scopus_raw %>% "
"0","  clean_names()%>%"
"0","  filter(year<2026)# Convierte ""Source title"" en ""source_title"", etc."
"0",""
"0","# B. Analisis Temporal (Tendencia)"
"0","trend_data <- data %>%"
"0","  count(year) %>%"
"0","  arrange(year) %>%"
"0","  mutate("
"0","    growth = (n - lag(n)) / lag(n) * 100,"
"0","    growth_label = paste0(round(growth, 1), ""%"")"
"0","  )"
"0",""
"0",""
"0",""
"0",""
"0",""
"0","# C. Desglosando Autores (Separar filas por ; )"
"0","authors_df <- data %>%"
"0","  select(year, authors) %>%"
"0","  separate_rows(authors, sep = "";"") %>%"
"0","  mutate(authors = str_trim(authors)) %>%"
"0","  filter(authors != """")"
"0",""
"0","# D. Desglosando Palabras Clave"
"0","keywords_df <- data %>%"
"0","  select(author_keywords) %>%"
"0","  drop_na() %>%"
"0","  separate_rows(author_keywords, sep = "";"") %>%"
"0","  mutate(word = str_trim(str_to_lower(author_keywords))) %>%"
"0","  count(word, sort = TRUE)"
"0",""
"0","# E. Extraccion de Paises (Desde Afiliaciones)"
"0","# Truco: Extraemos la última palabra de la afiliación o buscamos match con lista de paises"
"0","extract_country <- function(affil_string) {"
"0","  if(is.na(affil_string)) return(NA)"
"0","  # Busca nombres de paises en el string"
"0","  matches <- str_extract_all(affil_string, paste(countrycode::codelist$country.name.en, collapse = ""|""))[[1]]"
"0","  if(length(matches) > 0) return(unique(matches)) else return(NA)"
"0","}"
"0",""
"0",""
"0",""
"0",""
"0",""
"0",""
"0","# Nota: Esto puede tardar si son miles de registros. Simplificamos para el ejemplo."
"0","countries_df <- data %>%"
"0","  select(affiliations) %>%"
"0","  drop_na() %>%"
"0","  mutate(country = map(affiliations, ~ tryCatch(extract_country(.), error = function(e) NA))) %>%"
"0","  unnest(country) %>%"
"0","  count(country, sort = TRUE)"
"0",""
"0","# F. Colaboración Internacional"
"0","# Si una fila tiene >1 país distinto detectado en afiliaciones"
"0","collab_status <- data %>%"
"0","  mutate("
"0","    detected_countries = map(affiliations, ~ tryCatch(length(extract_country(.)), error = function(e) 0)),"
"0","    collab_type = if_else(detected_countries > 1, ""Internacional"", ""Nacional"")"
"0","  ) %>%"
"0","  count(collab_type)"
"0",""
"0",""
"0",""
"0","# --- 4. CREACION DE REDES (Manual) ---"
"0","# Red de co-autoria: Pares de autores que aparecen en el mismo documento"
"0","# Necesitamos un ID único por documento. Usamos row_number si no hay EID."
"0","author_network_df <- data %>%"
"0","  mutate(doc_id = row_number()) %>%"
"0","  select(doc_id, authors) %>%"
"0","  separate_rows(authors, sep = "";"") %>%"
"0","  mutate(authors = str_trim(authors))"
"0",""
"0","# Usamos widyr para contar pares"
"0","co_author_edges <- author_network_df %>%"
"0","  pairwise_count(authors, doc_id, sort = TRUE, upper = FALSE) %>%"
"0","  filter(n >= 1) # Filtrar colaboraciones minimas (ajustar segun volumen)"
"0",""
"0","# Crear objeto grafo"
"0","graph_authors <- as_tbl_graph(co_author_edges) %>%"
"0","  activate(nodes) %>%"
"0","  mutate(degree = centrality_degree()) %>%"
"0","  arrange(desc(degree)) %>%"
"0","  filter(degree > 0) # Top nodos"
"0",""
